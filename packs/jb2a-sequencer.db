{"_id":"0YKebSxRJO3pb4PY","name":"Magical Rune","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Magic_Signs/Runes/AbjurationRuneLoop_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR MAGIC SIGNS : RUNE with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available magical runes animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\ntokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n\nnew Sequence()\n//Will play the intro sequence of the blue abjuration rune animation.\n    .effect()\n        .file(\"jb2a.magic_signs.rune.abjuration.intro.blue\") //Edit this line to customize the intro animation as follow : jb2a.magic_signs.rune.schoolofmagicname.intro.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .waitUntilFinished(-550)\n//Then it will transition to the loop sequence of the blue abjuration rune animation.\n    .effect()\n        .file(\"jb2a.magic_signs.rune.abjuration.loop.blue\") //Edit this line to customize the loop animation as follow : jb2a.magic_signs.rune.schoolofmagicname.loop.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .fadeIn(200)\n        .fadeOut(200)\n        .waitUntilFinished(-550)\n//Finally it will play the outro sequence of the blue abjuration rune animation as follow : jb2a.magic_signs.rune.schoolofmagicname.outro.color\n    .effect()\n        .file(\"jb2a.magic_signs.rune.abjuration.outro.blue\") //Edit this line to customize the outro animation.\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens()\n    .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.sAqn9zEdCes0LaRk"}}}
{"_id":"0mrTnbabcdSDrGel","name":"Fireball","type":"script","author":"fgJl9vo2lDyR201q","img":"modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballExplosion_01_Orange_Thumb.webp","scope":"global","command":"//THIS MACRO NEEDS THE WARPGATE MODULE AND IS INTENDED FOR FIREBALL ONLY.\n//\n\n//TO USE THIS MACRO, you'll need Wasp's \"Sequencer\" module and Honeybadger's Wargate module\n//We cannot recommend reading through the Sequencer wiki enough, to learn how the magic happens : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Although this macro only uses a very, very small part of Warpgate, there is so much more to do and learn from the documentation and wiki : https://github.com/trioderegion/warpgate\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our Fireball explosion animation.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of exploding fireball leaving cracks on the ground and choose the right file corresponding to the distance between the caster and the selected position. \n//Don't forget to select the caster before using this macro.\n\n\nlet config = {\n    size:8,\n    icon: 'modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballExplosion_01_Orange_Thumb.webp',\n    label: 'Fireball',\n    tag: 'chop power',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1\n}\n\n\nconst selected = canvas.tokens.controlled[0];\nlet position = await warpgate.crosshairs.show(config);\n\nlet sequence = new Sequence()\n\n    .effect()\n        .file(\"jb2a.fireball.beam.orange\")\n        .atLocation(selected)\n        .stretchTo(position)\n    .effect()\n        .file(\"jb2a.fireball.explosion.orange\")\n        .atLocation(position)\n        .delay(2100)\n    .effect()\n        .file(\"jb2a.ground_cracks.orange.01\")\n//        .file(\"modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballBlast_01_Orange_800x800.webm\") //This file isn't part of our module, but it can be downloaded here : https://www.dropbox.com/s/7z72w0cjznx6yeo/Modified_Blast_Tile_From_ForgottenAdventures.zip?dl=1\n        .atLocation(position)\n        .belowTokens()\n        .scaleIn(0.5, 150, {ease: \"easeOutExpo\"})\n        .duration(5000)\n        .fadeOut(3250, {ease: \"easeInSine\"})\n        .name(\"Fireball_Impact\")\n        .delay(2300)\n        .waitUntilFinished(-3250)\n    .effect()\n        .file(\"jb2a.impact.ground_crack.still_frame.01\")\n        .atLocation(position)\n        .belowTokens()\n        .fadeIn(300, {ease: \"easeInSine\"})\n        .name(\"Fireball_Impact\")\n        .persist()\n.play();","folder":null,"sort":0,"permission":{"default":0,"fgJl9vo2lDyR201q":3},"flags":{"core":{"sourceId":"Macro.cNDVcu9Iut7LYUsg"}}}
{"_id":"2x13zL5QMfbWGnTw","name":"Weapon Throw","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Weapon_Attacks/Ranged/Dagger01_01_Regular_White_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR WEAPON THROW ONLY (Use the macro WeaponThrowWithReturn if you to have a return animation for the dagger01 or hammer01)\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available thrown attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the throw sequence of the Dagger01 animation. \n\nlet selectedToken = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nfor(target of targets){\nnew Sequence()\n    .effect()\n//For example, to follow the list above, change it to jb2a.lasersword_db.throw.orange to play the double bladed thrown orange lasersword animation.\n//Another example, jb2a.handaxe.throw.02 to play the second version of the handaxe animation.\n        .file(\"jb2a.dagger.throw.01.white\") //Replace the text between quotation marks.\n        .atLocation(selectedToken)\n        .reachTowards(target)\n    .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.MNrsQfdjEKY7SiQN"}}}
{"_id":"IgHwAvi7QkiK6NIG","name":"Moonbeam","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/2nd_Level/Moonbeam/Moonbeam_01_Regular_Rainbow_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR MOONBEAM - MARKER LIGHT - MARKER BUBBLE. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\" and Honeybadger's module called \"Warp Gate\"\n//You can find their respective documentation on Github : \n//Sequencer : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Warp Gate : https://github.com/trioderegion/warpgate\n\n//Let's first use Warp Gate to determine where to place the effect.\nlet config = {\n    size:2,\n    icon: 'modules/jb2a_patreon/Library/2nd_Level/Moonbeam/Moonbeam_01_Regular_Rainbow_Thumb.webp',\n    label: 'Moonbeam',\n    tag: 'shiny',\n    t: 'circle',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1,\n}\n//This will make the \"Crosshair\" appear. \nlet position = await warpgate.crosshairs.show(config);\n//As soon as you click, the position will be recorded and we'll hand this over to Sequencer below with .atLocation()\n\n\nnew Sequence()\n//Will play the intro sequence of the Moonbeam animation.\n    .effect()\n        .file(\"jb2a.moonbeam.01.intro.rainbow\") //Edit this line to customize the intro animation as follow jb2a.moonbeam.01.intro.color\n        .atLocation(position)\n        .waitUntilFinished(-600)\n//Then it will transition to the loop sequence of the Moonbeam animation.        \n    .effect()\n        .file(\"jb2a.moonbeam.01.loop.rainbow\") //Edit this line to customize the loop animation as follow jb2a.moonbeam.version_number.loop.color\n        .atLocation(position)\n        .fadeIn(250)\n        .fadeOut(250)\n        .waitUntilFinished(-600)\n//Finally it will play the outro sequence of the Moonbeam animation as follow jb2a.moonbeam.version_number.outro.color. \n//You can also change '_explode' to '_fade' to have a different ending.\n    .effect()\n        .file(\"jb2a.moonbeam.01.outro.rainbow\") //Edit this line to customize the outro animation.\n        .atLocation(position)\n            \n    .play()","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.R7tnPORKQZaZVVAQ"},"advanced-macros":{"runAsGM":false}}}
{"_id":"KKT1iIDgvfOLae7t","name":"Arrows - Bolts with Sneak Attack","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/1st_Level/Sneak_Attack/Sneak_Attack_Regular_Orange_Thumb.webp","scope":"global","command":"//FOR THE SNEAK ATTACK ANIMATION WITH RANGED ATTACK LILE ARROWS, BOLTS AND BULLETS ONLY.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Arrow/Bolts/Bullets attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of the arrow and choose the right file corresponding to the distance between the caster and the target. \n\nlet target = Array.from(game.user.targets)[0];\n\nlet sequence = new Sequence()\n\n    .effect()\n//This part will play the Sneak Attack animation.\n//For example, following available colors listed above, if you want the dark red sneak attack animation change it to jb2a.sneak_attack.dark_red\n\n        .file(\"jb2a.sneak_attack.orange\") //Replace the text between quotation marks.\n\n//You can change 'target' by 'canvas.tokens.controlled[0]' if you want the animation to be on the caster instead of the target.\n        .atLocation(target)\n        .anchor({ x: 0.5, y: 1 })\n        .scale(.5)\n\n//OPTIONAL you can delete the following sequence if you don't want the text animation\n\n    .effect()\n//This part will play the animated text Sneak Attack.\n//Choose between jb2a.sneak_attack_text.01 and jb2a.sneak_attack_text.02\n\n        .file(\"jb2a.sneak_attack_text.01\") //Replace the text between quotation marks.\n\n//You can change 'target' by 'canvas.tokens.controlled[0]' if you want the animation to be on the caster instead of the target.\n        .atLocation(target)\n        .anchor({ x: 0.5, y: 0.25 })\n        .scale(.5)\n\n    .effect()\n//It will play the animation of the arrow or bolt and choose the right file corresponding to the distance between the caster and the target. \n//For example, to follow the list above, change it to jb2a.arrow.lightning.green to play a green arrow attack with lightning damage type.\n//Another example, jb2a.bolt.cold.blue to play a blue bolt with cold damage type.\n\n        .file(\"jb2a.arrow.physical.white.02\") //Replace the text between quotation marks.\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n\n//This is a delay before the melee attack begins.\n//The value is in milliseconds, modify it as you wish. \n//You can delete the line if you don't want the delay.\n        .delay(2000)\n\n    .play();","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.VMqfpWOrXtbAu43w"}}}
{"_id":"KxpMYi6NruEo3oXl","name":"Bless","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/1st_Level/Bless/Bless_01_Regular_Yellow_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR the spell BLESS.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//Bless has an intro for when the spell is cast and a looped version to make it last a bit longer (or to be used in Custom Token Animations for a marker)\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available on tokens animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//Let's first define which tokens are targeted\nlet targets = Array.from(game.user.targets);\n//For each target of the targets array, we'll play a sequence\nfor(let target of targets){       \n    new Sequence()\n    .effect()\n    //Here's how we call on to an asset using our database registered with Sequencer.\n    //Without the database, it would look something like this : \n    //.file(\"modules/jb2a_patreon/Library/1st_Level/Bless/Bless_01_Regular_Yellow_Intro_400x400.webm\")\n    \n        .file(\"jb2a.bless.200px.intro.yellow\")\n        //Where do we want the animation to be played ? on the target we defined in the for loop.\n        .atLocation(target)\n        //We want the next asset, which will be the looped version, to start slightly before the end of the intro to make the transition smoother\n        .waitUntilFinished(-500) \n    //Now, let's call the looped version. Same principle as for the intro       \n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(target)    \n        .waitUntilFinished(-500)        \n    //I seperated this last looped version to be able to add a Fadeout at the end of 1000ms or 1 second before the end of the animation.\n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(target)\n        .fadeOut(1000)\n    .play()\n    \n};","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.40JOS43fUORukZmw"}}}
{"_id":"LdsGWRuWadfWxuLk","name":"Whirl","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Template/Circle/Whirl_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR THE WHIRL CIRCLE TEMPLATE with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Whirl color variations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.25;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence()\n//Will play the intro sequence of a blue whirl animation.\n    .effect()\n        .file(\"jb2a.template_circle.whirl.intro.blue\") //Edit this line to customize the intro animation as follow : jb2a.template_circle.whirl.intro.color\n        .atLocation(selectedToken)\n        .scale(tokenSize * effectScale)\n        //.belowTokens() \n        .waitUntilFinished(-1000)\n//Then it will transition to the loop sequence of a blue whirl animation.\n    .effect()\n        .file(\"jb2a.template_circle.whirl.loop.blue\") //Edit this line to customize the loop animation as follow : jb2a.template_circle.whirl.loop.color\n        .atLocation(selectedToken)\n        .scale(tokenSize * effectScale)\n        //.belowTokens()\n        .fadeIn(500)\n        .fadeOut(500)\n        .waitUntilFinished(-1000)\n//Finally it will play the outro sequence of a blue whirl animation as follow : jb2a.template_circle.whirl.outro.color\n    .effect()\n        .file(\"jb2a.template_circle.whirl.outro.blue\") //Edit this line to customize the outro animation.\n        .atLocation(selectedToken)\n        .scale(tokenSize * effectScale)\n        //.belowTokens() \n            \n    .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.e3oACqy4EALxW2N9"}}}
{"_id":"OLpfJputKKvgWZbl","name":"Vortex","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Template/Circle/Vortex_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR THE VORTEX CIRCLE TEMPLATE with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Vortex color variations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n\n    new Sequence()\n    //Will play the intro sequence of a blue vortex animation.\n        .effect()\n            .file(\"jb2a.template_circle.vortex.intro.blue\") //Edit this line to customize the intro animation as follow : jb2a.template_circle.vortexvortex.intro.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .belowTokens() \n            .waitUntilFinished(-1000)\n    //Then it will transition to the loop sequence of a blue vortex animation.\n        .effect()\n            .file(\"jb2a.template_circle.vortex.loop.blue\") //Edit this line to customize the loop animation as follow : jb2a.template_circle.vortexvortex.loop.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .belowTokens()\n            .fadeIn(500)\n            .fadeOut(500)\n            .waitUntilFinished(-1000)\n    //Finally it will play the outro sequence of a blue vortex animation as follow : jb2a.template_circle.vortexvortex.outro.color\n        .effect()\n            .file(\"jb2a.template_circle.vortex.outro.blue\") //Edit this line to customize the outro animation.\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .belowTokens() \n\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.e3oACqy4EALxW2N9"}}}
{"_id":"OPmTe5RQUPaeUlbs","name":"Chain Lightning ItemMacro","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/6th_Level/Chain_Lightning/ChainLightning_01_Regular_Blue_Primary_Thumb.webp","scope":"global","command":"//Special Thanks to @Wasp for the inspiration and code for the dialog option !\n\n// Requires the JB2A Patreon module installed and activated\n// Requires the Sequencer module\n// Requires the Item Macro module (with the \"character sheet hook\" option enabled)\n\n// Open the ItemMacro option on the top bar of the spell item and paste this macro within. \n// Roll the item with the primary token targeted.\n\nlet error = false;\n\nif(!game.modules.get(\"jb2a_patreon\") && !game.modules.get(\"JB2A_DnD5e\")){ // all these are to make sure the relevant modules are installed and activated in the world and warn the user if not.\n    error = `You need to have one of the JB2A modules installed and active to run this macro !`;\n}\nif(game.modules.get(\"jb2a_patreon\") && !game.modules.get(\"jb2a_patreon\").active){\n    error = `The \"JB2A Patreon Pack\" is installed. However, make sure it is also active for its sequencer database to be registered !`;\n}\nif(game.modules.get(\"JB2A_DnD5e\") && !game.modules.get(\"JB2A_DnD5e\").active){\n    error = `The \"JB2A free Pack\" is installed. However, make sure it is also active for its sequencer database to be registered !`;\n}\nif(!game.modules.get(\"itemacro\")){\n    error = `You need to have the module \"Item Macro\" installed to run this macro !`;\n}\nif(!game.modules.get(\"itemacro\").active){\n    error = `The \"Item Macro\" module needs to be active !`;\n}\n\nif(!game.modules.get(\"sequencer\")){\n    error = `You need to have the module \"Sequencer\" installed to run this macro !`;\n}\nif(!game.modules.get(\"sequencer\").active){\n    error = `The \"Sequencer\" module needs to be active !`;\n}\n\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nconst actorD = token.actor;\nconst tokenD = token;\nconst spellLevel = actorD.spellLevel ? Number(actorD.spellLevel) : 6;\nconst targetsToJumpTo = 3 + (spellLevel-6);\nconst spellSaveDC = actorD.data.data.attributes.spelldc;\n\nasync function wait(ms) { \n    return new Promise((resolve) => {\n        setTimeout(resolve, ms);\n    });\n}\n\n// This function will output the text needed for the saving throw chat card of each target\nfunction addTokenToText(token, roll, dc){ \n\n    return `<div>\n      <div> ${token.name}</div>\n      <div>\n         ${roll >= dc ? \"<span style='color: #20854a;'>succeeds</span> with \" \n         + roll \n         + \"<span style='color: #20854a;'> (DC \" + spellSaveDC + \")</span>\" : \"<span style='color: #ad1f1f;'>fails</span> with \" \n         + roll \n         + \"<span style='color: #ad1f1f;'> (DC \" + spellSaveDC + \")</span>\"}\n        \n      </div>\n      <div><img src=\"${token.data.img}\" height=\"30\" style=\"border:0px\"></div>\n    </div>`;\n\n}\n\nasync function main(){\n\n    let chatMessageContent;\n\n\n    const targetToken = Array.from(game.user.targets)[0]; // this is the primary target\n\n// enemies will be the potential secondary targets to choose from (conditions : within 30ft distance of the priamry target and health is above 0)\n    let enemies = canvas.tokens.placeables.filter(function(target){ \n        return target?.actor?.data?.data?.attributes?.hp?.value > 0\n            && canvas.grid.measureDistance(targetToken, target) <= 32.5\n            && target !== targetToken\n            && target !== tokenD\n    });\n\n    let targetList = \"\";\n\n    for (let target of enemies) { // for each secondary target\n        //targetList and the_content is going to populate the pop-up dialog that lets you select the secondary targets\n        targetList += `<tr class='chainLightningToken' id='${target.id}'>\n            <td><img src=\"${target?.data?.img}\" width=\"30\" height=\"30\" style=\"border:0px\"> - ${target.name}</td>\n            <td><input type=\"checkbox\" class='target' name=\"${target.id}\"></td>\n        </tr>`;\n    }\n\n    let the_content = `\n        <p>Your Chain Lightning can jump to <b>${targetsToJumpTo}</b> targets.</p>\n        <form class=\"flexcol\">\n            <table width=\"100%\">\n                <tbody>\n                    <tr><th>Target</th>\n                    <th>Jump to</th>\n                    </tr>${targetList}\n                </tbody>\n            </table>\n        </form>`;\n\n    new Dialog({\n        title: \"Select targets for Chain Lightning to jump to\",\n        content: the_content, \n        buttons: {\n            one: { //only one button necessary. The callback function is what's executed when the button is pressed.\n                label: \"Damage\", callback: async (html) => {\n\n                    $(\".chainLightningToken\").off(\"mouseenter\").off(\"mouseleave\");\n                    let targets = html.find('input.target').filter((index, elem) => {\n                        return $(elem).is(\":checked\")\n                    });\n\n                    let targetTokens = new Set();\n                    \n                    let damageRoll = await new Roll(`${item.data.data.damage.parts[0][0]}`).evaluate({async: true});\n                    damageRoll.toMessage({flavor: `<h2>${item.data.data.damage.parts[0][1]} Damage !</h2>`});\n                    let save = await new Roll(\"1d20+@mod\",{mod: targetToken?.actor?.data?.data?.abilities?.dex?.save ?? 0}).evaluate({async:true});\n                    chatMessageContent = addTokenToText(targetToken, save.total, spellSaveDC);\n                    save.toMessage({flavor: chatMessageContent});\n\n                    let chains = 0;\n                    chatMessageContent = \"\";\n                    \n                    for(let target of targets){ // now that we have pressed the button, for each target we'll roll the save, send it to a chat card.\n                        chains++;                        \n                        if(chains > targetsToJumpTo) break;\n\n                        let enemyToken = canvas.tokens.get(target.name)\n\n                        let save = await new Roll(\"1d20+@mod\",{mod: enemyToken?.actor?.data?.data?.abilities?.dex?.save ?? 0}).evaluate({async:true});\n                        chatMessageContent += addTokenToText(enemyToken, save.total, spellSaveDC);\n                        \n\n                        targetTokens.add(enemyToken)\n                    }\n\n                    if(chatMessageContent !== \"\"){ // if no secondary targets are selected, this will return false and no additional message will be created\n                    ChatMessage.create({\n                        speaker: ChatMessage.getSpeaker(),\n                        flavor: chatMessageContent \n                    });\n                    }\n\n\n                    let sequence = new Sequence() // this is the naimation part, handled by the Sequencer module\n                        .effect()\n                            .file(\"jb2a.chain_lightning.primary.blue\")\n                            .atLocation(tokenD) // Going from origin\n                            .stretchTo(targetToken) // To the current loop's target                                            \n                            .waitUntilFinished(-1100)// The next sequence will start 1.1 seconds before the end of the primary Lightning\n\n                        .effect()\n                            .file(\"jb2a.static_electricity.02.blue\")\n                            .atLocation(targetToken)\n                            .wait(100)\n\n                    for(let target of targetTokens){\n                        sequence\n                            .effect()\n                                .file(\"jb2a.chain_lightning.secondary.blue\")\n                                .atLocation(targetToken) // Going from origin\n                                .stretchTo(target) // To the current loop's target                                                     \n                                .wait(100)// Slight delay between each arc\n                    }\n\n                    sequence.play()\n\n                }\n            }\n        }\n    }).render(true);\n\n    await wait(100);\n\n    $(\".chainLightningToken\").on(\"mouseenter\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverIn(e);\n    }).on(\"mouseleave\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverOut(e);\n    });\n\n}\n\nmain()\n\n// this outputs the normal chat card.\nawait item.roll() \n\n/*\n//But you could do something like this instead of await item.roll() to create your own chat card ! \n\nconst itemDescription = item.data.data.description.value;\nconst itemTitle = `<img src=\"${item.data.img}\" height=\"30\" style=\"border:0px\"><h2>${item.data.name.toUpperCase()}</h2>`;\nChatMessage.create({\n    speaker: ChatMessage.getSpeaker(),\n    flavor: itemTitle + itemDescription\n});\n*/","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.sb2mEl3FIPiwfoQs"}}}
{"_id":"OaxFfzKCB906cwnH","name":"Magic Circle","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Magic_Signs/EvocationCircleIntro_02_Regular_Red_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR MAGIC CIRCLES with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available magic circles animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.25;\nlet tokenSize;\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence()\n//Will play the intro sequence of the red evocation magic circle animation.\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.evocation.intro.red\") //Edit this line to customize the intro animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.intro.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .waitUntilFinished(-550)\n//Then it will transition to the loop sequence of the red evocation magic circle animation.\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.evocation.loop.red\") //Edit this line to customize the loop animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.loop.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .fadeIn(200)\n        .fadeOut(200)\n        .waitUntilFinished(-550)\n//Finally it will play the outro sequence of the red evocation magic circle animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.outro.color\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.evocation.outro.red\") //Edit this line to customize the outro animation.\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n    .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.e3oACqy4EALxW2N9"}}}
{"_id":"U84i42GxjvmFypNg","name":"Shield","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/1st_Level/Shield/Shield_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR SHIELD. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Shield animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n\n    new Sequence()\n    //Will play the intro sequence of the Shield animation.\n        .effect()\n            .file(\"jb2a.shield.01.intro.blue\") //Edit this line to customize the intro animation as follow jb2a.shield.version_number.intro.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .waitUntilFinished(-500)\n    //Then it will transition to the loop sequence of the Shield animation.        \n        .effect()\n            .file(\"jb2a.shield.01.loop.blue\") //Edit this line to customize the loop animation as follow jb2a.shield.version_number.loop.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .fadeIn(300)\n            .fadeOut(300)\n            .waitUntilFinished(-500)\n    //Finally it will play the outro sequence of the Shield animation as follow jb2a.shield.version_number.outro.color. \n    //You can also change '_explode' to '_fade' to have a different ending.\n        .effect()\n            .file(\"jb2a.shield.01.outro_explode.blue\") //Edit this line to customize the outro animation.\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.R7tnPORKQZaZVVAQ"},"advanced-macros":{"runAsGM":false}}}
{"_id":"VLM1Ux0dHLDHlsD1","name":"Energy Field","type":"script","author":"fgJl9vo2lDyR201q","img":"modules/jb2a_patreon/Library/Generic/Energy/EnergyFieldTop_02_Regular_Blue_Thumb.webp","scope":"global","command":"let selectedTokens = canvas.tokens.controlled; //for targeted tokens instead, use Array.from(game.user.targets);\nlet effectScale = 0.4; // this serves as a multiplier for the size of the effect.\nlet effectColor = \"blue\";\nlet effectFade = 1000;\n// You can change the color by replacing \"blue\" by \"green\" for example.\n//Click the Sequencer Database button to see all available colors.\n\nlet tokenSize; // here, we define this variable that we will calculate inside the following loop, for each selected token\n//let's create a loop that will apply the effect on each selected token.\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence() \n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.energy_field.02.below.${effectColor}`)\n        .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n        .name(\"EnergyFieldBlue\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.energy_field.02.above.${effectColor}`)\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()\n        .name(\"EnergyFieldBlue\")//Named it the same so we can dismiss both at the same time\n      .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      // Sequencer.EffectManager.endEffects({name: \"EnergyFieldBlue\"})","folder":null,"sort":0,"permission":{"default":0,"fgJl9vo2lDyR201q":3},"flags":{"core":{"sourceId":"Macro.KiPOhDcj3o8N4emD"}}}
{"_id":"Z2RZcBOL5MDcdaS2","name":"MoltenEarth Orange Shield","type":"script","author":"fgJl9vo2lDyR201q","img":"modules/jb2a_patreon/Library/Generic/Fire/ShieldMoltenEarthAbove01_01_Regular_Orange_Thumb.webp","scope":"global","command":"//THIS MACRO NEEDS SEQUENCER TO WORK.\n//It is intended for animated assets like ShieldEldritchWeb | ShieldIce | ShieldFire | ShieldMoltenEarth\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet effectColor = \"orange\"; //Click the Sequencer Database button to see all available colors.\nlet effectFade = 1000;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence() \n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.shield_themed.below.molten_earth.01.${effectColor}`)\n        .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n        .name(\"MoltenEarth Shield\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.shield_themed.above.molten_earth.01.${effectColor}`)\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()\n        .name(\"MoltenEarth Shield\")//Named it the same so we can dismiss both at the same time\n      .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      //Sequencer.EffectManager.endEffects({name: \"MoltenEarth Shield\"})","folder":null,"sort":0,"permission":{"default":0,"fgJl9vo2lDyR201q":3},"flags":{"core":{"sourceId":"Macro.KiPOhDcj3o8N4emD"}}}
{"_id":"abMdDlrrV40qs24d","name":"Falling Rocks","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Traps/Falling_Rocks/FallingRocks01Side_01_Regular_Grey_05x05ft_Thumb.webp","scope":"global","command":"// This macro uses the Sequencer module.\n// Info, tutorials and examples available on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our Falling Rocks animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it in .file() to customize the macro.\n\nlet selectedTokens = canvas.tokens.controlled; // This will output an array of all currently selected tokens.\n\n// this following loop will play the animation for each selected token (each element of the array)\nfor(let selectedToken of selectedTokens){\n    new Sequence()\n        .effect()\n            .file(\"jb2a.falling_rocks.top.1x1.sandstone\") // in between the \"\", you can paste the database path of another asset. For example, \"jb2a.falling_rocks.top.1x1.sandstone.1\"\n            .scale(0.5)\n            .atLocation(selectedToken)\n            .fadeOut(250, {ease: \"easeInSine\"})\n            .randomizeMirrorX() // as its name suggests, this will randomize how it's displayed and avoid repetition as much as possible\n            .randomizeMirrorY() \n    .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.drbQMVC8Ny3qmNKS"}}}
{"_id":"adTg04hKTgSH503P","name":"Arrows - Bolts","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Weapon_Attacks/Ranged/Arrow02_01_Regular_White_Physical_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR ARROWS AND BOLTS ONLY.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available arrow attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of the arrow or bolt and choose the right file corresponding to the distance between the caster and the target. \n//For example, to follow the list above, change it to jb2a.arrow.lightning.green to play a green arrow attack with lightning damage type.\n//Another example, jb2a.bolt.cold.blue to play a blue bolt with cold damage type.\n\nlet selectedToken = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nfor(let target of targets){\nnew Sequence()\n    .effect()\n        .file(\"jb2a.arrow.physical.white.02\") //Replace the text between quotation marks.\n        .atLocation(selectedToken)\n        .stretchTo(target)       \n    .play();\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.SCLqktdZTaBKsVFY"},"advanced-macros":{"runAsGM":false}}}
{"_id":"eECkcu3LjPftQiTK","name":"Dodecahedron","type":"script","author":"M6ZzqXxgKE4iLUP6","img":"modules/jb2a_patreon/Library/Generic/Energy/Dodecahedron_01_Regular_Blue_Thumb.webp","scope":"global","command":"let effectScale = 0.35; // this serves as a multiplier for the size of the effect.\nlet effectFade = 250;\nlet tokenSize; // here, we define this variable that we will calculate inside the following loop, for each selected token\n//In this loop, we'll apply the effect on each token targeted.\nfor (let target of Array.from(game.user.targets)){\n    tokenSize = (target.data.width + target.data.height) /2;  \n    new Sequence() \n        .effect()\n            .attachTo(target)        \n            .file(`jb2a.dodecahedron.star.below.blueyellow`)\n            .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n            .scale(effectScale * tokenSize)\n            .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n            .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n            .name(\"Dodecahedron-stars\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n        .effect()\n            .attachTo(target)\n            .file(`jb2a.dodecahedron.star.above.blueyellow`)\n            .scale(effectScale * tokenSize)\n            .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n            .persist()\n            .name(\"Dodecahedron-stars\")//Named it the same so we can dismiss both at the same time if needed, via macro. See below\n          .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      // Sequencer.EffectManager.endEffects({name: \"Dodecahedron-stars\"})","folder":null,"sort":0,"permission":{"default":0,"M6ZzqXxgKE4iLUP6":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.td0FSeUvPTLRf3aP"}}}
{"_id":"hM0Elo75l1aaIVLE","name":"Melee Attacks - 2 Random from list","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Weapon_Attacks/Melee/Quarterstaff01_05_Regular_White_Thumb.webp","scope":"global","command":"//You'll need the module Sequence from Wasp to be Able to use this macro.\n//https://github.com/fantasycalendar/FoundryVTT-Sequencer\n\n//You can use our macro called \"Sequencer Database Search\" to find and preview all melee attacks available in our library.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset in a single click.\n\n//This macro is for Melee Attack only.\n//It plays a succession of two random melee attacks seamlessly. \n\nlet target = Array.from(game.user.targets)[0];\n\nlet sequence = new Sequence()\n    .effect()\n //Choose your melee attack animation and replace \"jb2a.quarterstaff.melee.01.white\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.quarterstaff.melee.01.white\")\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n//This is a delay before the next melee attack begins. The value is in milliseconds, modify it as you wish. This delay is specifically with the new melee weapon attacks.\n        .waitUntilFinished(-500) \n    .effect()\n //Choose your melee attack animation and replace \"jb2a.quarterstaff.melee.01.random_white\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.quarterstaff.melee.01.white\")\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n.play()","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.SCLqktdZTaBKsVFY"},"advanced-macros":{"runAsGM":false}}}
{"_id":"hjvb13bKW5vvdM5U","name":"Grease","type":"script","author":"YTrIZxEYoA9ntq1q","img":"modules/jb2a_patreon/Library/1st_Level/Grease/Grease_Dark_Brown_Thumb.webp","scope":"global","command":"//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\" and Honeybadger's module called \"Warp Gate\"\n//You can find their respective documentation on Github : \n//Sequencer : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Warp Gate : https://github.com/trioderegion/warpgate\n\n//Let's first use Warp Gate to determine where to place the effect.\nlet config = {\n    size:2,\n    icon: 'modules/jb2a_patreon/Library/1st_Level/Grease/Grease_Dark_Brown_Thumb.webp',\n    label: 'Grease',\n    tag: 'slimy',\n    t: 'Square',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1,\n}\n//This will make the \"Crosshair\" appear. \nlet position = await warpgate.crosshairs.show(config);\n//As soon as you click, the position will be recorded and we'll hand this over to Sequencer below with .atLocation()\nnew Sequence()\n    .effect()\n        .file('jb2a.grease.dark_brown')\n        .atLocation(position)\n        .belowTokens()\n        .persist() //we want this to keep on looping until we tell it to stop\n        .name('Grease')\n    .play()\n\n//IMPORTANT : Assets placed with this macros can only be deleted from the canvas with the Sequencer Effect Viewer located in the FOUNDRYVTT toolbar.\n//or from another macro with this line : \n//Sequencer.EffectManager.endEffects({name: 'Grease'})","folder":null,"sort":0,"permission":{"default":0,"YTrIZxEYoA9ntq1q":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.nJPJFQpcAhaku1Kg"}}}
{"_id":"jNZHsDeJLHX4lGRZ","name":"Energy Strands","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Marker/EnergyStrands_01_Dark_Red_Thumb.webp","scope":"global","command":"let selectedTokens = canvas.tokens.controlled;//for targeted tokens instead, use Array.from(game.user.targets);\nlet effectColor = \"dark_red\";\n// You can change the color by replacing \"Dark_Red\" by \"Regular_PinkYellow\" for example.\n//Click the Sequencer Database button to see all available colors.\nlet effectScale = 0.25; // this serves as a multiplier for the size of the effect.\nlet tokenSize; // here, we define this variable that we will calculate inside the following loop, for each selected token\n//let's create a loop that will apply the effect on each selected token.\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n    new Sequence() \n        .effect()\n            .attachTo(selectedToken)\n            .file(`jb2a.energy_strands.complete.${effectColor}.01`)\n            .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n            .scale(effectScale * tokenSize)\n            .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n            .name(\"EnergyStrand\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n        .effect()\n            .attachTo(selectedToken)\n            .file(`jb2a.energy_strands.overlay.${effectColor}.01`)\n            .scale(effectScale * tokenSize)\n            .persist()\n            .name(\"EnergyStrand\")//Named it the same so we can dismiss both at the same time\n          .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      //Sequencer.EffectManager.endEffects({name: \"EnergyStrand\"})","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.HkjvnmGTtESQyGBo"}}}
{"_id":"mHujsyqWCEnHSmYC","name":"Melee Attack with Impact VFX","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Impact/GroundCrackImpact_01_Regular_Orange_Thumb.webp","scope":"global","command":"//You'll need the module Sequence from Wasp to be Able to use this macro.\n//https://github.com/fantasycalendar/FoundryVTT-Sequencer\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available melee attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//This macro is for Melee Attack only.\n//It adds a Ground crack impact as soon as the animation of the Maul hits the target.\n\nlet target = Array.from(game.user.targets)[0];\n\nlet sequence = new Sequence()\n\n    .effect()\n //Choose your melee attack animation and replace \"jb2a.maul.melee.white\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.maul.melee.white\")\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n        .waitUntilFinished(-1100)\n//This is a delay before the VFX added to the melee attack begins. The value is in milliseconds, modify it as you wish. This delay is specifically with this melee attack.\n    .effect()\n //Choose your desired VFX and replace \"jb2a.impact.ground_crack.orange.01\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.impact.ground_crack.orange.01\")\n        .atLocation(target)\n        .scale(0.5)\n        .belowTokens()\n    .play();","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.DYvyPibMnhfujaNc"}}}
{"_id":"qGW1gDiMPp7QBJMy","name":"Weapon Throw with Return","type":"script","author":"yGU1Czx7TqFhg8CG","img":"modules/jb2a_patreon/Library/Generic/Weapon_Attacks/Ranged/Dagger01_01_Regular_White_Return_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR WEAPON THROW AND RETURN. Currently only for Dagger01 and the Hammer01.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available thrown attack with return animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\nlet selectedToken = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nfor(let target of targets){\n    new Sequence()\n        .effect()\n    //First it will play the throw sequence of the Dagger01 animation. \n    //Change it to jb2a.hammer.throw.01 to play the Hammer01 animation.\n            .file(\"jb2a.dagger.throw.01.white\")\n            .atLocation(selectedToken)\n            .stretchTo(target)\n            //OPTIONAL\n            //You can adjust the value below to play the return part before or after the throwing animation ends.\n            //The current value should make the transition seamless or barely noticeable.\n            //A negative value will play the return part before the throwing animation ends. And a positive value will add a pause between the throw and the return animation. \n            .waitUntilFinished(-700) //In milliseconds  \n        .effect()\n    //Then it will transition to the return animation of the Dagger01. \n    //Change it to jb2a.hammer.return.01 to play the return version of the Hammer01 animation.  \n            .file(\"jb2a.dagger.return.01.white\")\n            .atLocation(selectedToken)\n            .stretchTo(target)\n    .play()\n}","folder":null,"sort":0,"permission":{"default":0,"yGU1Czx7TqFhg8CG":3},"flags":{"core":{"sourceId":"Macro.kSfIaywHwfY3sKXI"}}}
{"_id":"vFy3jum0N6MTY3lB","name":"Swirling Sparkles","type":"script","author":"M6ZzqXxgKE4iLUP6","img":"modules/jb2a_patreon/Library/Generic/Energy/SwirlingSparkles_01_Regular_GreenOrange_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR the SWIRLING SPARKLES.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//this is an example of how to combine two swirling sparkles to make it look a bit different\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 1;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n    new Sequence()\n      .effect()\n        .file(\"jb2a.swirling_sparkles.01.greenorange\")//you can change the color here by replacing greenorange by blue, bluepink or orangepurple\n        .atLocation(selectedToken)//we are playing this animation on the first selected token\n        .scale(-1 * effectScale * tokenSize)// the -1 here means it will flip the animation\n        .wait(150)// we're delaying it very slightly to avoid having a perfect mirrored symmetry. You can try without and see which one you prefer !\n      .effect()\n        .file(\"jb2a.swirling_sparkles.01.greenorange\")\n        .atLocation(selectedToken)\n        .scale(effectScale * tokenSize)\n      .play()\n}","folder":null,"sort":0,"permission":{"default":0,"M6ZzqXxgKE4iLUP6":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.3Uu8n46ZVpedKOsb"}}}
{"$$deleted":true,"_id":"adTg04hKTgSH503P"}
{"$$deleted":true,"_id":"KKT1iIDgvfOLae7t"}
{"$$deleted":true,"_id":"KxpMYi6NruEo3oXl"}
{"$$deleted":true,"_id":"OPmTe5RQUPaeUlbs"}
{"$$deleted":true,"_id":"eECkcu3LjPftQiTK"}
{"$$deleted":true,"_id":"VLM1Ux0dHLDHlsD1"}
{"$$deleted":true,"_id":"jNZHsDeJLHX4lGRZ"}
{"$$deleted":true,"_id":"abMdDlrrV40qs24d"}
{"$$deleted":true,"_id":"0mrTnbabcdSDrGel"}
{"$$deleted":true,"_id":"hjvb13bKW5vvdM5U"}
{"$$deleted":true,"_id":"OaxFfzKCB906cwnH"}
{"$$deleted":true,"_id":"0YKebSxRJO3pb4PY"}
{"$$deleted":true,"_id":"mHujsyqWCEnHSmYC"}
{"$$deleted":true,"_id":"hM0Elo75l1aaIVLE"}
{"$$deleted":true,"_id":"Z2RZcBOL5MDcdaS2"}
{"$$deleted":true,"_id":"IgHwAvi7QkiK6NIG"}
{"$$deleted":true,"_id":"U84i42GxjvmFypNg"}
{"$$deleted":true,"_id":"vFy3jum0N6MTY3lB"}
{"$$deleted":true,"_id":"OLpfJputKKvgWZbl"}
{"$$deleted":true,"_id":"2x13zL5QMfbWGnTw"}
{"$$deleted":true,"_id":"qGW1gDiMPp7QBJMy"}
{"$$deleted":true,"_id":"LdsGWRuWadfWxuLk"}
{"name":"Arrows - Bolts","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/Arrow01_01_Regular_White_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR ARROWS AND BOLTS ONLY.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available arrow attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of the arrow or bolt and choose the right file corresponding to the distance between the caster and the target. \n//For example, to follow the list above, change it to jb2a.arrow.lightning.green to play a green arrow attack with lightning damage type.\n//Another example, jb2a.bolt.cold.blue to play a blue bolt with cold damage type.\n\nlet selectedToken = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nfor(let target of targets){\nnew Sequence()\n    .effect()\n        .file(\"jb2a.arrow.physical.white.01\") //Replace the text between quotation marks.\n        .atLocation(selectedToken)\n        .stretchTo(target)       \n    .play();\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.SCLqktdZTaBKsVFY"},"advanced-macros":{"runAsGM":false}},"_id":"9Uqq27aB4pwygo9H"}
{"name":"Arrows - Bolts with Sneak Attack","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/1st_Level/Sneak_Attack/Sneak_Attack_Dark_Green_Thumb.webp","scope":"global","command":"//FOR THE SNEAK ATTACK ANIMATION WITH RANGED ATTACK LILE ARROWS, BOLTS AND BULLETS ONLY.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Arrow/Bolts/Bullets attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of the arrow and choose the right file corresponding to the distance between the caster and the target. \n\nlet target = Array.from(game.user.targets)[0];\n\nlet sequence = new Sequence()\n\n    .effect()\n//This part will play the Sneak Attack animation.\n//For example, following available colors listed above, if you want the dark red sneak attack animation change it to jb2a.sneak_attack.dark_red\n\n        .file(\"jb2a.sneak_attack.dark_green\") //Replace the text between quotation marks.\n\n//You can change 'target' by 'canvas.tokens.controlled[0]' if you want the animation to be on the caster instead of the target.\n        .atLocation(target)\n        .anchor({ x: 0.5, y: 1 })\n        .scale(.5)\n\n//OPTIONAL you can delete the following sequence if you don't want the text animation\n\n    .effect()\n//This part will play the animated text Sneak Attack.\n//Choose between jb2a.sneak_attack_text.01 and jb2a.sneak_attack_text.02\n\n        .file(\"jb2a.sneak_attack_text.01\") //Replace the text between quotation marks.\n\n//You can change 'target' by 'canvas.tokens.controlled[0]' if you want the animation to be on the caster instead of the target.\n        .atLocation(target)\n        .anchor({ x: 0.5, y: 0.25 })\n        .scale(.5)\n\n    .effect()\n//It will play the animation of the arrow or bolt and choose the right file corresponding to the distance between the caster and the target. \n//For example, to follow the list above, change it to jb2a.arrow.lightning.green to play a green arrow attack with lightning damage type.\n//Another example, jb2a.bolt.cold.blue to play a blue bolt with cold damage type.\n\n        .file(\"jb2a.arrow.physical.white.01\") //Replace the text between quotation marks.\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n\n//This is a delay before the melee attack begins.\n//The value is in milliseconds, modify it as you wish. \n//You can delete the line if you don't want the delay.\n        .delay(2000)\n\n    .play();","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.VMqfpWOrXtbAu43w"}},"_id":"OlAryXyVI7AOqM7a"}
{"name":"Bless","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/1st_Level/Bless/Bless_01_Regular_Yellow_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR the spell BLESS.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//Bless has an intro for when the spell is cast and a looped version to make it last a bit longer (or to be used in Custom Token Animations for a marker)\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available on tokens animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//Let's first define which tokens are targeted\nlet targets = Array.from(game.user.targets);\n//For each target of the targets array, we'll play a sequence\nfor(let target of targets){       \n    new Sequence()\n    .effect()\n    //Here's how we call on to an asset using our database registered with Sequencer.\n    //Without the database, it would look something like this : \n    //.file(\"modules/jb2a_patreon/Library/1st_Level/Bless/Bless_01_Regular_Yellow_Intro_400x400.webm\")\n    \n        .file(\"jb2a.bless.200px.intro.yellow\")\n        //Where do we want the animation to be played ? on the target we defined in the for loop.\n        .atLocation(target)\n        //We want the next asset, which will be the looped version, to start slightly before the end of the intro to make the transition smoother\n        .waitUntilFinished(-500) \n    //Now, let's call the looped version. Same principle as for the intro       \n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(target)    \n        .waitUntilFinished(-500)        \n    //I seperated this last looped version to be able to add a Fadeout at the end of 1000ms or 1 second before the end of the animation.\n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(target)\n        .fadeOut(1000)\n    .play()\n    \n};","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.40JOS43fUORukZmw"}},"_id":"NhSjJ3IP13sAMxv7"}
{"name":"Chain Lightning ItemMacro","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/6th_Level/Chain_Lightning/ChainLightning_01_Regular_Blue_Primary_Thumb.webp","scope":"global","command":"//Special Thanks to @Wasp for the inspiration and code for the dialog option !\n\n// Requires the JB2A Patreon module installed and activated\n// Requires the Sequencer module\n// Requires the Item Macro module (with the \"character sheet hook\" option enabled)\n\n// Open the ItemMacro option on the top bar of the spell item and paste this macro within. \n// Roll the item with the primary token targeted.\n\nlet error = false;\n\nif(!game.modules.get(\"jb2a_patreon\") && !game.modules.get(\"JB2A_DnD5e\")){ // all these are to make sure the relevant modules are installed and activated in the world and warn the user if not.\n    error = `You need to have one of the JB2A modules installed and active to run this macro !`;\n}\nif(game.modules.get(\"jb2a_patreon\") && !game.modules.get(\"jb2a_patreon\").active){\n    error = `The \"JB2A Patreon Pack\" is installed. However, make sure it is also active for its sequencer database to be registered !`;\n}\nif(game.modules.get(\"JB2A_DnD5e\") && !game.modules.get(\"JB2A_DnD5e\").active){\n    error = `The \"JB2A free Pack\" is installed. However, make sure it is also active for its sequencer database to be registered !`;\n}\nif(!game.modules.get(\"itemacro\")){\n    error = `You need to have the module \"Item Macro\" installed to run this macro !`;\n}\nif(!game.modules.get(\"itemacro\").active){\n    error = `The \"Item Macro\" module needs to be active !`;\n}\n\nif(!game.modules.get(\"sequencer\")){\n    error = `You need to have the module \"Sequencer\" installed to run this macro !`;\n}\nif(!game.modules.get(\"sequencer\").active){\n    error = `The \"Sequencer\" module needs to be active !`;\n}\n\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nconst actorD = token.actor;\nconst tokenD = token;\nconst spellLevel = actorD.spellLevel ? Number(actorD.spellLevel) : 6;\nconst targetsToJumpTo = 3 + (spellLevel-6);\nconst spellSaveDC = actorD.data.data.attributes.spelldc;\n\nasync function wait(ms) { \n    return new Promise((resolve) => {\n        setTimeout(resolve, ms);\n    });\n}\n\n// This function will output the text needed for the saving throw chat card of each target\nfunction addTokenToText(token, roll, dc){ \n\n    return `<div>\n      <div> ${token.name}</div>\n      <div>\n         ${roll >= dc ? \"<span style='color: #20854a;'>succeeds</span> with \" \n         + roll \n         + \"<span style='color: #20854a;'> (DC \" + spellSaveDC + \")</span>\" : \"<span style='color: #ad1f1f;'>fails</span> with \" \n         + roll \n         + \"<span style='color: #ad1f1f;'> (DC \" + spellSaveDC + \")</span>\"}\n        \n      </div>\n      <div><img src=\"${token.data.img}\" height=\"30\" style=\"border:0px\"></div>\n    </div>`;\n\n}\n\nasync function main(){\n\n    let chatMessageContent;\n\n\n    const targetToken = Array.from(game.user.targets)[0]; // this is the primary target\n\n// enemies will be the potential secondary targets to choose from (conditions : within 30ft distance of the priamry target and health is above 0)\n    let enemies = canvas.tokens.placeables.filter(function(target){ \n        return target?.actor?.data?.data?.attributes?.hp?.value > 0\n            && canvas.grid.measureDistance(targetToken, target) <= 32.5\n            && target !== targetToken\n            && target !== tokenD\n    });\n\n    let targetList = \"\";\n\n    for (let target of enemies) { // for each secondary target\n        //targetList and the_content is going to populate the pop-up dialog that lets you select the secondary targets\n        targetList += `<tr class='chainLightningToken' id='${target.id}'>\n            <td><img src=\"${target?.data?.img}\" width=\"30\" height=\"30\" style=\"border:0px\"> - ${target.name}</td>\n            <td><input type=\"checkbox\" class='target' name=\"${target.id}\"></td>\n        </tr>`;\n    }\n\n    let the_content = `\n        <p>Your Chain Lightning can jump to <b>${targetsToJumpTo}</b> targets.</p>\n        <form class=\"flexcol\">\n            <table width=\"100%\">\n                <tbody>\n                    <tr><th>Target</th>\n                    <th>Jump to</th>\n                    </tr>${targetList}\n                </tbody>\n            </table>\n        </form>`;\n\n    new Dialog({\n        title: \"Select targets for Chain Lightning to jump to\",\n        content: the_content, \n        buttons: {\n            one: { //only one button necessary. The callback function is what's executed when the button is pressed.\n                label: \"Damage\", callback: async (html) => {\n\n                    $(\".chainLightningToken\").off(\"mouseenter\").off(\"mouseleave\");\n                    let targets = html.find('input.target').filter((index, elem) => {\n                        return $(elem).is(\":checked\")\n                    });\n\n                    let targetTokens = new Set();\n                    \n                    let damageRoll = await new Roll(`${item.data.data.damage.parts[0][0]}`).evaluate({async: true});\n                    damageRoll.toMessage({flavor: `<h2>${item.data.data.damage.parts[0][1]} Damage !</h2>`});\n                    let save = await new Roll(\"1d20+@mod\",{mod: targetToken?.actor?.data?.data?.abilities?.dex?.save ?? 0}).evaluate({async:true});\n                    chatMessageContent = addTokenToText(targetToken, save.total, spellSaveDC);\n                    save.toMessage({flavor: chatMessageContent});\n\n                    let chains = 0;\n                    chatMessageContent = \"\";\n                    \n                    for(let target of targets){ // now that we have pressed the button, for each target we'll roll the save, send it to a chat card.\n                        chains++;                        \n                        if(chains > targetsToJumpTo) break;\n\n                        let enemyToken = canvas.tokens.get(target.name)\n\n                        let save = await new Roll(\"1d20+@mod\",{mod: enemyToken?.actor?.data?.data?.abilities?.dex?.save ?? 0}).evaluate({async:true});\n                        chatMessageContent += addTokenToText(enemyToken, save.total, spellSaveDC);\n                        \n\n                        targetTokens.add(enemyToken)\n                    }\n\n                    if(chatMessageContent !== \"\"){ // if no secondary targets are selected, this will return false and no additional message will be created\n                    ChatMessage.create({\n                        speaker: ChatMessage.getSpeaker(),\n                        flavor: chatMessageContent \n                    });\n                    }\n\n\n                    let sequence = new Sequence() // this is the naimation part, handled by the Sequencer module\n                        .effect()\n                            .file(\"jb2a.chain_lightning.primary.blue\")\n                            .atLocation(tokenD) // Going from origin\n                            .stretchTo(targetToken) // To the current loop's target                                            \n                            .waitUntilFinished(-1100)// The next sequence will start 1.1 seconds before the end of the primary Lightning\n\n                        .effect()\n                            .file(\"jb2a.static_electricity.02.blue\")\n                            .atLocation(targetToken)\n                            .wait(100)\n\n                    for(let target of targetTokens){\n                        sequence\n                            .effect()\n                                .file(\"jb2a.chain_lightning.secondary.blue\")\n                                .atLocation(targetToken) // Going from origin\n                                .stretchTo(target) // To the current loop's target                                                     \n                                .wait(100)// Slight delay between each arc\n                    }\n\n                    sequence.play()\n\n                }\n            }\n        }\n    }).render(true);\n\n    await wait(100);\n\n    $(\".chainLightningToken\").on(\"mouseenter\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverIn(e);\n    }).on(\"mouseleave\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverOut(e);\n    });\n\n}\n\nmain()\n\n// this outputs the normal chat card.\nawait item.roll() \n\n/*\n//But you could do something like this instead of await item.roll() to create your own chat card ! \n\nconst itemDescription = item.data.data.description.value;\nconst itemTitle = `<img src=\"${item.data.img}\" height=\"30\" style=\"border:0px\"><h2>${item.data.name.toUpperCase()}</h2>`;\nChatMessage.create({\n    speaker: ChatMessage.getSpeaker(),\n    flavor: itemTitle + itemDescription\n});\n*/","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.sb2mEl3FIPiwfoQs"}},"_id":"yOlf90cuC67jwAUN"}
{"name":"Energy Field","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Energy/EnergyFieldTop_02_Regular_Blue_Thumb.webp","scope":"global","command":"let selectedTokens = canvas.tokens.controlled; //for targeted tokens instead, use Array.from(game.user.targets);\nlet effectScale = 0.4; // this serves as a multiplier for the size of the effect.\nlet effectColor = \"blue\";\nlet effectFade = 1000;\n// You can change the color by replacing \"blue\" by \"green\" for example.\n//Click the Sequencer Database button to see all available colors.\n\nlet tokenSize; // here, we define this variable that we will calculate inside the following loop, for each selected token\n//let's create a loop that will apply the effect on each selected token.\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence() \n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.energy_field.02.below.${effectColor}`)\n        .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n        .name(\"EnergyFieldBlue\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.energy_field.02.above.${effectColor}`)\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()\n        .name(\"EnergyFieldBlue\")//Named it the same so we can dismiss both at the same time\n      .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      // Sequencer.EffectManager.endEffects({name: \"EnergyFieldBlue\"})","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.KiPOhDcj3o8N4emD"}},"_id":"PUrID8s6oNTnXKtQ"}
{"name":"Energy Strands","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Marker/EnergyStrands_01_Regular_Blue_Thumb.webp","scope":"global","command":"let selectedTokens = canvas.tokens.controlled;//for targeted tokens instead, use Array.from(game.user.targets);\nlet effectColor = \"blue\";\n// You can change the color by replacing \"Dark_Red\" by \"Regular_PinkYellow\" for example.\n//Click the Sequencer Database button to see all available colors.\nlet effectScale = 0.25; // this serves as a multiplier for the size of the effect.\nlet tokenSize; // here, we define this variable that we will calculate inside the following loop, for each selected token\n//let's create a loop that will apply the effect on each selected token.\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n    new Sequence() \n        .effect()\n            .attachTo(selectedToken)\n            .file(`jb2a.energy_strands.complete.${effectColor}.01`)\n            .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n            .scale(effectScale * tokenSize)\n            .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n            .name(\"EnergyStrand\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n        .effect()\n            .attachTo(selectedToken)\n            .file(`jb2a.energy_strands.overlay.${effectColor}.01`)\n            .scale(effectScale * tokenSize)\n            .persist()\n            .name(\"EnergyStrand\")//Named it the same so we can dismiss both at the same time\n          .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      //Sequencer.EffectManager.endEffects({name: \"EnergyStrand\"})","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.HkjvnmGTtESQyGBo"}},"_id":"aemLITe41fKoUoSq"}
{"name":"Falling Rocks","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Traps/Falling_Rocks/FallingRocks01Side_01_Regular_Grey_05x05ft_Thumb.webp","scope":"global","command":"// This macro uses the Sequencer module.\n// Info, tutorials and examples available on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our Falling Rocks animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it in .file() to customize the macro.\n\nlet selectedTokens = canvas.tokens.controlled; // This will output an array of all currently selected tokens.\n\n// this following loop will play the animation for each selected token (each element of the array)\nfor(let selectedToken of selectedTokens){\n    new Sequence()\n        .effect()\n            .file(\"jb2a.falling_rocks.top.1x1.grey\") // in between the \"\", you can paste the database path of another asset. For example, \"jb2a.falling_rocks.top.1x1.sandstone\" (available in the Patreon Pack)\n            .scale(0.5)\n            .atLocation(selectedToken)\n            .fadeOut(250, {ease: \"easeInSine\"})\n            .randomizeMirrorX() // as its name suggests, this will randomize how it's displayed and avoid repetition as much as possible\n            .randomizeMirrorY() \n    .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.drbQMVC8Ny3qmNKS"}},"_id":"dOM1qtdUClAqM4WN"}
{"name":"Fireball","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/3rd_Level/Fireball/FireballExplosion_01_Orange_Thumb.webp","scope":"global","command":"//THIS MACRO NEEDS THE WARPGATE MODULE AND IS INTENDED FOR FIREBALL ONLY.\n//\n\n//TO USE THIS MACRO, you'll need Wasp's \"Sequencer\" module and Honeybadger's Wargate module\n//We cannot recommend reading through the Sequencer wiki enough, to learn how the magic happens : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Although this macro only uses a very, very small part of Warpgate, there is so much more to do and learn from the documentation and wiki : https://github.com/trioderegion/warpgate\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our Fireball explosion animation.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of exploding fireball leaving cracks on the ground and choose the right file corresponding to the distance between the caster and the selected position. \n//Don't forget to select the caster before using this macro.\n\n\nlet config = {\n    size:8,\n    icon: 'modules/JB2A_DnD5e/Library/3rd_Level/Fireball/FireballExplosion_01_Orange_Thumb.webp',\n    label: 'Fireball',\n    tag: 'chop power',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1\n}\n\n\nconst selected = canvas.tokens.controlled[0];\nlet position = await warpgate.crosshairs.show(config);\n\nlet sequence = new Sequence()\n\n    .effect()\n        .file(\"jb2a.fireball.beam.orange\")\n        .atLocation(selected)\n        .stretchTo(position)\n    .effect()\n        .file(\"jb2a.fireball.explosion.orange\")\n        .atLocation(position)\n        .delay(2100)\n    .effect()\n        .file(\"jb2a.ground_cracks.orange.01\")\n//        .file(\"modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballBlast_01_Orange_800x800.webm\") //This file isn't part of our module, but it can be downloaded here : https://www.dropbox.com/s/7z72w0cjznx6yeo/Modified_Blast_Tile_From_ForgottenAdventures.zip?dl=1\n        .atLocation(position)\n        .belowTokens()\n        .scaleIn(0.5, 150, {ease: \"easeOutExpo\"})\n        .duration(5000)\n        .fadeOut(3250, {ease: \"easeInSine\"})\n        .name(\"Fireball_Impact\")\n        .delay(2300)\n        .waitUntilFinished(-3250)\n    .effect()\n        .file(\"jb2a.impact.ground_crack.still_frame.01\")\n        .atLocation(position)\n        .belowTokens()\n        .fadeIn(300, {ease: \"easeInSine\"})\n        .name(\"Fireball_Impact\")\n        .persist()\n.play();","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.cNDVcu9Iut7LYUsg"}},"_id":"rmn3iYk9eX0yugAR"}
{"name":"Grease","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/1st_Level/Grease/Grease_Dark_Brown_Thumb.webp","scope":"global","command":"//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\" and Honeybadger's module called \"Warp Gate\"\n//You can find their respective documentation on Github : \n//Sequencer : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Warp Gate : https://github.com/trioderegion/warpgate\n\n//Let's first use Warp Gate to determine where to place the effect.\nlet config = {\n    size:2,\n    icon: 'modules/JB2A_DnD5e/Library/1st_Level/Grease/Grease_Dark_Brown_Thumb.webp',\n    label: 'Grease',\n    tag: 'slimy',\n    t: 'Square',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1,\n}\n//This will make the \"Crosshair\" appear. \nlet position = await warpgate.crosshairs.show(config);\n//As soon as you click, the position will be recorded and we'll hand this over to Sequencer below with .atLocation()\nnew Sequence()\n    .effect()\n        .file('jb2a.grease.dark_brown')\n        .atLocation(position)\n        .belowTokens()\n        .persist() //we want this to keep on looping until we tell it to stop\n        .name('Grease')\n    .play()\n\n//IMPORTANT : Assets placed with this macros can only be deleted from the canvas with the Sequencer Effect Viewer located in the FOUNDRYVTT toolbar.\n//or from another macro with this line : \n//Sequencer.EffectManager.endEffects({name: 'Grease'})","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.nJPJFQpcAhaku1Kg"}},"_id":"C1OvVZMp9d82igCD"}
{"name":"Icosahedron","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Energy/IcosahedronStarAbove_01_Regular_BlueYellow_Thumb.webp","scope":"global","command":"let effectScale = 0.35; // this serves as a multiplier for the size of the effect.\nlet effectFade = 250;\nlet tokenSize; // here, we define this variable that we will calculate inside the following loop, for each selected token\n//In this loop, we'll apply the effect on each token targeted.\nfor (let target of Array.from(game.user.targets)){\n    tokenSize = (target.data.width + target.data.height) /2;  \n    new Sequence() \n        .effect()\n            .attachTo(target)        \n            .file(`jb2a.icosahedron.star.below.blueyellow`)\n            .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n            .scale(effectScale * tokenSize)\n            .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n            .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n            .name(\"Iscosahedron-stars\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n        .effect()\n            .attachTo(target)\n            .file(`jb2a.icosahedron.star.above.blueyellow`)\n            .scale(effectScale * tokenSize)\n            .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n            .persist()\n            .name(\"Icosahedron-stars\")//Named it the same so we can dismiss both at the same time if needed, via macro. See below\n          .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      // Sequencer.EffectManager.endEffects({name: \"Icosahedron-stars\"})","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.td0FSeUvPTLRf3aP"}},"_id":"4PTLjC4A3S3UlwY2"}
{"name":"Magic Circle","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Magic_Signs/EvocationCircleIntro_02_Regular_Red_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR MAGIC CIRCLES with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available magic circles animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.25;\nlet tokenSize;\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence()\n//Will play the intro sequence of the red evocation magic circle animation.\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.evocation.intro.red\") //Edit this line to customize the intro animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.intro.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .waitUntilFinished(-550)\n//Then it will transition to the loop sequence of the red evocation magic circle animation.\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.evocation.loop.red\") //Edit this line to customize the loop animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.loop.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .fadeIn(200)\n        .fadeOut(200)\n        .waitUntilFinished(-550)\n//Finally it will play the outro sequence of the red evocation magic circle animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.outro.color\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.evocation.outro.red\") //Edit this line to customize the outro animation.\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n    .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.e3oACqy4EALxW2N9"}},"_id":"59QD8R6jX5whsSEg"}
{"name":"Magical Rune","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Magic_Signs/Runes/AbjurationRuneLoop_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR MAGIC SIGNS : RUNE with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available magical runes animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\ntokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n\nnew Sequence()\n//Will play the intro sequence of the blue abjuration rune animation.\n    .effect()\n        .file(\"jb2a.magic_signs.rune.abjuration.intro.blue\") //Edit this line to customize the intro animation as follow : jb2a.magic_signs.rune.schoolofmagicname.intro.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .waitUntilFinished(-550)\n//Then it will transition to the loop sequence of the blue abjuration rune animation.\n    .effect()\n        .file(\"jb2a.magic_signs.rune.abjuration.loop.blue\") //Edit this line to customize the loop animation as follow : jb2a.magic_signs.rune.schoolofmagicname.loop.color\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens() \n        .fadeIn(200)\n        .fadeOut(200)\n        .waitUntilFinished(-550)\n//Finally it will play the outro sequence of the blue abjuration rune animation as follow : jb2a.magic_signs.rune.schoolofmagicname.outro.color\n    .effect()\n        .file(\"jb2a.magic_signs.rune.abjuration.outro.blue\") //Edit this line to customize the outro animation.\n        .scale(effectScale * tokenSize)\n        .atLocation(selectedToken)\n        .belowTokens()\n    .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.sAqn9zEdCes0LaRk"}},"_id":"q9HKhFkD7ZHRkFCp"}
{"name":"Melee Attack with Impact VFX","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Impact/GroundCrackImpact_01_Regular_Orange_Thumb.webp","scope":"global","command":"//You'll need the module Sequence from Wasp to be Able to use this macro.\n//https://github.com/fantasycalendar/FoundryVTT-Sequencer\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available melee attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//This macro is for Melee Attack only.\n//It adds a Ground crack impact as soon as the animation of the Maul hits the target.\n\nlet target = Array.from(game.user.targets)[0];\n\nlet sequence = new Sequence()\n\n    .effect()\n //Choose your melee attack animation and replace \"jb2a.maul.melee.white\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.maul.melee.white\")\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n        .waitUntilFinished(-1100)\n//This is a delay before the VFX added to the melee attack begins. The value is in milliseconds, modify it as you wish. This delay is specifically with this melee attack.\n    .effect()\n //Choose your desired VFX and replace \"jb2a.impact.ground_crack.orange\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.impact.ground_crack.orange\")\n        .atLocation(target)\n        .scale(0.5)\n        .belowTokens()\n    .play();","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.DYvyPibMnhfujaNc"}},"_id":"dChhc1wlwLD7Ydpq"}
{"name":"Melee Attacks - 2 Random from list","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Melee/Quarterstaff01_05_Regular_White_Thumb.webp","scope":"global","command":"//You'll need the module Sequence from Wasp to be Able to use this macro.\n//https://github.com/fantasycalendar/FoundryVTT-Sequencer\n\n//You can use our macro called \"Sequencer Database Search\" to find and preview all melee attacks available in our library.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset in a single click.\n\n//This macro is for Melee Attack only.\n//It plays a succession of two random melee attacks seamlessly. \n\nlet target = Array.from(game.user.targets)[0];\n\nlet sequence = new Sequence()\n    .effect()\n //Choose your melee attack animation and replace \"jb2a.quarterstaff.melee.01.white\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.quarterstaff.melee.01.white\")\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n//This is a delay before the next melee attack begins. The value is in milliseconds, modify it as you wish. This delay is specifically with the new melee weapon attacks.\n        .waitUntilFinished(-500) \n    .effect()\n //Choose your melee attack animation and replace \"jb2a.quarterstaff.melee.01.random_white\" by a file path or a database name from the Sequencer DataBase Macro.\n        .file(\"jb2a.quarterstaff.melee.01.white\")\n        .atLocation(canvas.tokens.controlled[0])\n        .stretchTo(target)\n.play()","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.SCLqktdZTaBKsVFY"},"advanced-macros":{"runAsGM":false}},"_id":"RmxGjmNx0aWSj2L2"}
{"name":"MoltenEarth Orange Shield","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Fire/ShieldMoltenEarthAbove01_01_Regular_Orange_Thumb.webp","scope":"global","command":"//THIS MACRO NEEDS SEQUENCER TO WORK.\n//It is intended for animated assets like ShieldEldritchWeb | ShieldIce | ShieldFire | ShieldMoltenEarth\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet effectColor = \"orange\"; //Click the Sequencer Database button to see all available colors.\nlet effectFade = 1000;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence() \n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.shield_themed.below.molten_earth.01.${effectColor}`)\n        .belowTokens()//by default, the effect would be played above the tokens, we want this one to be played underneath so we can place the overlay above it\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()//This will make it contiously loop until dismissed by another macro (see below) or by pressing the Sequencer Effects Viewer button.\n        .name(\"MoltenEarth Shield\")//Could be anything. This name will make it easier to delete it via macro (see commented macro below)\n    .effect()\n        .attachTo(selectedToken)\n        .file(`jb2a.shield_themed.above.molten_earth.01.${effectColor}`)\n        .scale(effectScale * tokenSize)\n        .fadeIn(effectFade, {ease: \"easeOutCubic\"})\n        .persist()\n        .name(\"MoltenEarth Shield\")//Named it the same so we can dismiss both at the same time\n      .play();\n}\n      //The text below is commented out. You can copy and paste it in another macro to dismiss the animation. Don't forget to remove the two forward slashes to uncomment it !\n\n      //Sequencer.EffectManager.endEffects({name: \"MoltenEarth Shield\"})","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.KiPOhDcj3o8N4emD"}},"_id":"kpWYzI3ckcFxmALA"}
{"name":"Moonbeam","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/2nd_Level/Moonbeam/Moonbeam_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR MOONBEAM - MARKER LIGHT - MARKER BUBBLE. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\" and Honeybadger's module called \"Warp Gate\"\n//You can find their respective documentation on Github : \n//Sequencer : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Warp Gate : https://github.com/trioderegion/warpgate\n\n//Let's first use Warp Gate to determine where to place the effect.\nlet config = {\n    size:2,\n    icon: 'modules/JB2A_DnD5e/Library/2nd_Level/Moonbeam/Moonbeam_01_Regular_Blue_Thumb.webp',\n    label: 'Moonbeam',\n    tag: 'shiny',\n    t: 'circle',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1,\n}\n//This will make the \"Crosshair\" appear. \nlet position = await warpgate.crosshairs.show(config);\n//As soon as you click, the position will be recorded and we'll hand this over to Sequencer below with .atLocation()\n\n\nnew Sequence()\n//Will play the intro sequence of the Moonbeam animation.\n    .effect()\n        .file(\"jb2a.moonbeam.01.intro.blue\") //Edit this line to customize the intro animation as follow jb2a.moonbeam.01.intro.color\n        .atLocation(position)\n        .waitUntilFinished(-600)\n//Then it will transition to the loop sequence of the Moonbeam animation.        \n    .effect()\n        .file(\"jb2a.moonbeam.01.loop.blue\") //Edit this line to customize the loop animation as follow jb2a.moonbeam.version_number.loop.color\n        .atLocation(position)\n        .fadeIn(250)\n        .fadeOut(250)\n        .waitUntilFinished(-600)\n//Finally it will play the outro sequence of the Moonbeam animation as follow jb2a.moonbeam.version_number.outro.color. \n//You can also change '_explode' to '_fade' to have a different ending.\n    .effect()\n        .file(\"jb2a.moonbeam.01.outro.blue\") //Edit this line to customize the outro animation.\n        .atLocation(position)\n            \n    .play()","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.R7tnPORKQZaZVVAQ"},"advanced-macros":{"runAsGM":false}},"_id":"I8bk8dF0t69eiI6p"}
{"name":"Shield","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/1st_Level/Shield/Shield_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR SHIELD. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Shield animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n\n    new Sequence()\n    //Will play the intro sequence of the Shield animation.\n        .effect()\n            .file(\"jb2a.shield.01.intro.blue\") //Edit this line to customize the intro animation as follow jb2a.shield.version_number.intro.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .waitUntilFinished(-500)\n    //Then it will transition to the loop sequence of the Shield animation.        \n        .effect()\n            .file(\"jb2a.shield.01.loop.blue\") //Edit this line to customize the loop animation as follow jb2a.shield.version_number.loop.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .fadeIn(300)\n            .fadeOut(300)\n            .waitUntilFinished(-500)\n    //Finally it will play the outro sequence of the Shield animation as follow jb2a.shield.version_number.outro.color. \n    //You can also change '_explode' to '_fade' to have a different ending.\n        .effect()\n            .file(\"jb2a.shield.01.outro_explode.blue\") //Edit this line to customize the outro animation.\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n        .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.R7tnPORKQZaZVVAQ"},"advanced-macros":{"runAsGM":false}},"_id":"gcMRfTnslkDCFHCh"}
{"name":"Swirling Sparkles","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Energy/SwirlingSparkles_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR the SWIRLING SPARKLES.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//this is an example of how to combine two swirling sparkles to make it look a bit different\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 1;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n    new Sequence()\n      .effect()\n        .file(\"jb2a.swirling_sparkles.01.blue\")//you can change the color here by replacing blueby blue, bluepink or orangepurple (available in the Patreon pack)\n        .atLocation(selectedToken)//we are playing this animation on the first selected token\n        .scale(-1 * effectScale * tokenSize)// the -1 here means it will flip the animation\n        .wait(150)// we're delaying it very slightly to avoid having a perfect mirrored symmetry. You can try without and see which one you prefer !\n      .effect()\n        .file(\"jb2a.swirling_sparkles.01.blue\")\n        .atLocation(selectedToken)\n        .scale(effectScale * tokenSize)\n      .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.3Uu8n46ZVpedKOsb"}},"_id":"GI6do0RNFUT90W9y"}
{"name":"Vortex","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Template/Circle/Vortex_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR THE VORTEX CIRCLE TEMPLATE with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Vortex color variations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.5;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\n\n    new Sequence()\n    //Will play the intro sequence of a blue vortex animation.\n        .effect()\n            .file(\"jb2a.template_circle.vortex.intro.blue\") //Edit this line to customize the intro animation as follow : jb2a.template_circle.vortexvortex.intro.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .belowTokens() \n            .waitUntilFinished(-1000)\n    //Then it will transition to the loop sequence of a blue vortex animation.\n        .effect()\n            .file(\"jb2a.template_circle.vortex.loop.blue\") //Edit this line to customize the loop animation as follow : jb2a.template_circle.vortexvortex.loop.color\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .belowTokens()\n            .fadeIn(500)\n            .fadeOut(500)\n            .waitUntilFinished(-1000)\n    //Finally it will play the outro sequence of a blue vortex animation as follow : jb2a.template_circle.vortexvortex.outro.color\n        .effect()\n            .file(\"jb2a.template_circle.vortex.outro.blue\") //Edit this line to customize the outro animation.\n            .scale(effectScale * tokenSize)\n            .atLocation(selectedToken)\n            .belowTokens() \n\n        .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.e3oACqy4EALxW2N9"}},"_id":"0A7GsVcYO7oJ5s22"}
{"name":"Weapon Throw","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/Dagger01_01_Regular_White_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR WEAPON THROW ONLY (Use the macro WeaponThrowWithReturn if you to have a return animation for the dagger01 or hammer01)\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available thrown attack animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the throw sequence of the Dagger01 animation. \n\nlet selectedToken = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nfor(target of targets){\nnew Sequence()\n    .effect()\n//For example, to follow the list above, change it to jb2a.lasersword_db.throw.orange to play the double bladed thrown orange lasersword animation.\n//Another example, jb2a.handaxe.throw.02 to play the second version of the handaxe animation.\n        .file(\"jb2a.dagger.throw.01.white\") //Replace the text between quotation marks.\n        .atLocation(selectedToken)\n        .stretchTo(target)\n    .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.MNrsQfdjEKY7SiQN"}},"_id":"4pALE2W6JG38b5UA"}
{"name":"Weapon Throw with Return","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Weapon_Attacks/Ranged/Dagger01_01_Regular_White_Return_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR WEAPON THROW AND RETURN. Currently only for Dagger01 and the Hammer01.\n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available thrown attack with return animations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\nlet selectedToken = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nfor(let target of targets){\n    new Sequence()\n        .effect()\n    //First it will play the throw sequence of the Dagger01 animation. \n    //Change it to jb2a.hammer.throw.01 to play the Hammer01 animation.\n            .file(\"jb2a.dagger.throw.01.white\")\n            .atLocation(selectedToken)\n            .stretchTo(target)\n            //OPTIONAL\n            //You can adjust the value below to play the return part before or after the throwing animation ends.\n            //The current value should make the transition seamless or barely noticeable.\n            //A negative value will play the return part before the throwing animation ends. And a positive value will add a pause between the throw and the return animation. \n            .waitUntilFinished(-700) //In milliseconds  \n        .effect()\n    //Then it will transition to the return animation of the Dagger01. \n    //Change it to jb2a.hammer.return.01 to play the return version of the Hammer01 animation.  \n            .file(\"jb2a.dagger.return.01.white\")\n            .atLocation(selectedToken)\n            .stretchTo(target)\n    .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"core":{"sourceId":"Macro.kSfIaywHwfY3sKXI"}},"_id":"v24ACH5xsHghmsJD"}
{"name":"Whirl","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/Generic/Template/Circle/Whirl_01_Regular_Blue_Thumb.webp","scope":"global","command":"//THIS MACRO IS INTENDED FOR THE WHIRL CIRCLE TEMPLATE with Intro/Loop/Outro. \n\n//TO USE THIS MACRO, you'll need Wasp's module called \"Sequencer\"\n//You can find its documentation here on Github : https://github.com/fantasycalendar/FoundryVTT-Sequencer\n//There is also a wiki with a lot more info if you want to dive into it : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n\n//You can use the \" Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our available Whirl color variations.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//You need to select a token before using the macro.\n\nlet selectedTokens = canvas.tokens.controlled;\nlet effectScale = 0.25;\nlet tokenSize;\n\nfor(let selectedToken of selectedTokens){\n\n    tokenSize = (selectedToken.data.width + selectedToken.data.height) /2;\nnew Sequence()\n//Will play the intro sequence of a blue whirl animation.\n    .effect()\n        .file(\"jb2a.template_circle.whirl.intro.blue\") //Edit this line to customize the intro animation as follow : jb2a.template_circle.whirl.intro.color\n        .atLocation(selectedToken)\n        .scale(tokenSize * effectScale)\n        //.belowTokens() \n        .waitUntilFinished(-1000)\n//Then it will transition to the loop sequence of a blue whirl animation.\n    .effect()\n        .file(\"jb2a.template_circle.whirl.loop.blue\") //Edit this line to customize the loop animation as follow : jb2a.template_circle.whirl.loop.color\n        .atLocation(selectedToken)\n        .scale(tokenSize * effectScale)\n        //.belowTokens()\n        .fadeIn(500)\n        .fadeOut(500)\n        .waitUntilFinished(-1000)\n//Finally it will play the outro sequence of a blue whirl animation as follow : jb2a.template_circle.whirl.outro.color\n    .effect()\n        .file(\"jb2a.template_circle.whirl.outro.blue\") //Edit this line to customize the outro animation.\n        .atLocation(selectedToken)\n        .scale(tokenSize * effectScale)\n        //.belowTokens() \n            \n    .play()\n}","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.e3oACqy4EALxW2N9"}},"_id":"8wTsHszafgDbzIK8"}
{"_id":"yOlf90cuC67jwAUN","name":"Chain Lightning ItemMacro","type":"script","author":"BEL3Iav6K058rvXZ","img":"modules/JB2A_DnD5e/Library/6th_Level/Chain_Lightning/ChainLightning_01_Regular_Blue_Primary_Thumb.webp","scope":"global","command":"//Special Thanks to @Wasp for the inspiration and code for the dialog option !\n\n// Requires the JB2A module installed and activated\n// Requires the Sequencer module\n// Requires the Item Macro module (with the \"character sheet hook\" option enabled)\n\n// Open the ItemMacro option on the top bar of the spell item and paste this macro within. \n// Roll the item with the primary token targeted.\n\nlet error = false;\n\nif(!game.modules.get(\"jb2a_patreon\") && !game.modules.get(\"JB2A_DnD5e\")){ // all these are to make sure the relevant modules are installed and activated in the world and warn the user if not.\n    error = `You need to have one of the JB2A modules installed and active to run this macro !`;\n}\nif(game.modules.get(\"jb2a_patreon\") && !game.modules.get(\"jb2a_patreon\").active){\n    error = `The \"JB2A Patreon Pack\" is installed. However, make sure it is also active for its sequencer database to be registered !`;\n}\nif(game.modules.get(\"JB2A_DnD5e\") && !game.modules.get(\"JB2A_DnD5e\").active){\n    error = `The \"JB2A free Pack\" is installed. However, make sure it is also active for its sequencer database to be registered !`;\n}\nif(!game.modules.get(\"itemacro\")){\n    error = `You need to have the module \"Item Macro\" installed to run this macro !`;\n}\nif(!game.modules.get(\"itemacro\").active){\n    error = `The \"Item Macro\" module needs to be active !`;\n}\n\nif(!game.modules.get(\"sequencer\")){\n    error = `You need to have the module \"Sequencer\" installed to run this macro !`;\n}\nif(!game.modules.get(\"sequencer\").active){\n    error = `The \"Sequencer\" module needs to be active !`;\n}\n\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nconst actorD = token.actor;\nconst tokenD = token;\nconst spellLevel = actorD.spellLevel ? Number(actorD.spellLevel) : 6;\nconst targetsToJumpTo = 3 + (spellLevel-6);\nconst spellSaveDC = actorD.data.data.attributes.spelldc;\n\nasync function wait(ms) { \n    return new Promise((resolve) => {\n        setTimeout(resolve, ms);\n    });\n}\n\n// This function will output the text needed for the saving throw chat card of each target\nfunction addTokenToText(token, roll, dc){ \n\n    return `<div>\n      <div> ${token.name}</div>\n      <div>\n         ${roll >= dc ? \"<span style='color: #20854a;'>succeeds</span> with \" \n         + roll \n         + \"<span style='color: #20854a;'> (DC \" + spellSaveDC + \")</span>\" : \"<span style='color: #ad1f1f;'>fails</span> with \" \n         + roll \n         + \"<span style='color: #ad1f1f;'> (DC \" + spellSaveDC + \")</span>\"}\n        \n      </div>\n      <div><img src=\"${token.data.img}\" height=\"30\" style=\"border:0px\"></div>\n    </div>`;\n\n}\n\nasync function main(){\n\n    let chatMessageContent;\n\n\n    const targetToken = Array.from(game.user.targets)[0]; // this is the primary target\n\n// enemies will be the potential secondary targets to choose from (conditions : within 30ft distance of the priamry target and health is above 0)\n    let enemies = canvas.tokens.placeables.filter(function(target){ \n        return target?.actor?.data?.data?.attributes?.hp?.value > 0\n            && canvas.grid.measureDistance(targetToken, target) <= 32.5\n            && target !== targetToken\n            && target !== tokenD\n    });\n\n    let targetList = \"\";\n\n    for (let target of enemies) { // for each secondary target\n        //targetList and the_content is going to populate the pop-up dialog that lets you select the secondary targets\n        targetList += `<tr class='chainLightningToken' id='${target.id}'>\n            <td><img src=\"${target?.data?.img}\" width=\"30\" height=\"30\" style=\"border:0px\"> - ${target.name}</td>\n            <td><input type=\"checkbox\" class='target' name=\"${target.id}\"></td>\n        </tr>`;\n    }\n\n    let the_content = `\n        <p>Your Chain Lightning can jump to <b>${targetsToJumpTo}</b> targets.</p>\n        <form class=\"flexcol\">\n            <table width=\"100%\">\n                <tbody>\n                    <tr><th>Target</th>\n                    <th>Jump to</th>\n                    </tr>${targetList}\n                </tbody>\n            </table>\n        </form>`;\n\n    new Dialog({\n        title: \"Select targets for Chain Lightning to jump to\",\n        content: the_content, \n        buttons: {\n            one: { //only one button necessary. The callback function is what's executed when the button is pressed.\n                label: \"Damage\", callback: async (html) => {\n\n                    $(\".chainLightningToken\").off(\"mouseenter\").off(\"mouseleave\");\n                    let targets = html.find('input.target').filter((index, elem) => {\n                        return $(elem).is(\":checked\")\n                    });\n\n                    let targetTokens = new Set();\n                    \n                    let damageRoll = await new Roll(`${item.data.data.damage.parts[0][0]}`).evaluate({async: true});\n                    damageRoll.toMessage({flavor: `<h2>${item.data.data.damage.parts[0][1]} Damage !</h2>`});\n                    let save = await new Roll(\"1d20+@mod\",{mod: targetToken?.actor?.data?.data?.abilities?.dex?.save ?? 0}).evaluate({async:true});\n                    chatMessageContent = addTokenToText(targetToken, save.total, spellSaveDC);\n                    save.toMessage({flavor: chatMessageContent});\n\n                    let chains = 0;\n                    chatMessageContent = \"\";\n                    \n                    for(let target of targets){ // now that we have pressed the button, for each target we'll roll the save, send it to a chat card.\n                        chains++;                        \n                        if(chains > targetsToJumpTo) break;\n\n                        let enemyToken = canvas.tokens.get(target.name)\n\n                        let save = await new Roll(\"1d20+@mod\",{mod: enemyToken?.actor?.data?.data?.abilities?.dex?.save ?? 0}).evaluate({async:true});\n                        chatMessageContent += addTokenToText(enemyToken, save.total, spellSaveDC);\n                        \n\n                        targetTokens.add(enemyToken)\n                    }\n\n                    if(chatMessageContent !== \"\"){ // if no secondary targets are selected, this will return false and no additional message will be created\n                    ChatMessage.create({\n                        speaker: ChatMessage.getSpeaker(),\n                        flavor: chatMessageContent \n                    });\n                    }\n\n\n                    let sequence = new Sequence() // this is the naimation part, handled by the Sequencer module\n                        .effect()\n                            .file(\"jb2a.chain_lightning.primary.blue\")\n                            .atLocation(tokenD) // Going from origin\n                            .stretchTo(targetToken) // To the current loop's target                                            \n                            .waitUntilFinished(-1100)// The next sequence will start 1.1 seconds before the end of the primary Lightning\n\n                        .effect()\n                            .file(\"jb2a.static_electricity.02.blue\")\n                            .atLocation(targetToken)\n                            .wait(100)\n\n                    for(let target of targetTokens){\n                        sequence\n                            .effect()\n                                .file(\"jb2a.chain_lightning.secondary.blue\")\n                                .atLocation(targetToken) // Going from origin\n                                .stretchTo(target) // To the current loop's target                                                     \n                                .wait(100)// Slight delay between each arc\n                    }\n\n                    sequence.play()\n\n                }\n            }\n        }\n    }).render(true);\n\n    await wait(100);\n\n    $(\".chainLightningToken\").on(\"mouseenter\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverIn(e);\n    }).on(\"mouseleave\", function(e){\n        let token = canvas.tokens.get($(this).attr('id'));\n        token._onHoverOut(e);\n    });\n\n}\n\nmain()\n\n// this outputs the normal chat card.\nawait item.roll() \n\n/*\n//But you could do something like this instead of await item.roll() to create your own chat card ! \n\nconst itemDescription = item.data.data.description.value;\nconst itemTitle = `<img src=\"${item.data.img}\" height=\"30\" style=\"border:0px\"><h2>${item.data.name.toUpperCase()}</h2>`;\nChatMessage.create({\n    speaker: ChatMessage.getSpeaker(),\n    flavor: itemTitle + itemDescription\n});\n*/","folder":null,"sort":0,"permission":{"BEL3Iav6K058rvXZ":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.sb2mEl3FIPiwfoQs"}}}
